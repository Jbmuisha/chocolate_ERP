{% extends 'layout.html' %} {% block content %}
<div class="p-6 max-w-5xl mx-auto">
  <h2 class="text-3xl font-extrabold text-rose-600 mb-8 text-center">
    Record Sale
  </h2>

  {% with messages = get_flashed_messages(with_categories=true) %} {% if
  messages %}
  <div class="mb-6 max-w-xl mx-auto">
    {% for category, message in messages %}
    <div
      class="p-4 rounded-lg bg-green-100 text-green-700 border border-green-300 mb-3 shadow-sm"
      role="alert"
    >
      {{ message }}
    </div>
    {% endfor %}
  </div>
  {% endif %} {% endwith %}

  <form
    method="POST"
    action="/submit_sale"
    class="space-y-6 mb-12 bg-white shadow-lg rounded-xl p-8 max-w-xl mx-auto"
  >
    <div>
      <label
        for="product_name"
        class="block text-sm font-semibold text-gray-700 mb-2"
        >Product Name</label
      >
      <input
        type="text"
        id="product_name"
        name="product_name"
        required
        class="w-full rounded-md border border-gray-300 px-4 py-3 text-gray-800 focus:outline-none focus:ring-2 focus:ring-rose-500 transition"
        placeholder="Enter product name"
      />
    </div>

    <div>
      <label
        for="quantity"
        class="block text-sm font-semibold text-gray-700 mb-2"
        >Quantity Sold</label
      >
      <input
        type="number"
        id="quantity"
        name="quantity"
        min="1"
        required
        class="w-full rounded-md border border-gray-300 px-4 py-3 text-gray-800 focus:outline-none focus:ring-2 focus:ring-rose-500 transition"
        placeholder="Enter quantity sold"
      />
    </div>

    <div>
      <label
        for="payment_method"
        class="block text-sm font-semibold text-gray-700 mb-2"
        >Payment Method</label
      >
      <select
        id="payment_method"
        name="payment_method"
        required
        class="w-full rounded-md border border-gray-300 px-4 py-3 text-gray-800 focus:outline-none focus:ring-2 focus:ring-rose-500 transition"
      >
        <option value="" disabled selected>Select payment method</option>
        <option value="cash">Cash</option>
        <option value="card">Card</option>
        <option value="mobile">Mobile</option>
      </select>
    </div>

    <div>
      <label
        for="customer"
        class="block text-sm font-semibold text-gray-700 mb-2"
        >Customer (optional)</label
      >
      <input
        type="text"
        id="customer"
        name="customer"
        class="w-full rounded-md border border-gray-300 px-4 py-3 text-gray-800 focus:outline-none focus:ring-2 focus:ring-rose-500 transition"
        placeholder="Customer name"
      />
    </div>

    <button
      type="submit"
      class="w-full bg-rose-600 hover:bg-rose-700 text-white font-semibold py-3 rounded-xl shadow-md transition"
    >
      Submit Sale
    </button>
  </form>

  <h3 class="text-2xl font-bold text-gray-800 mb-6 text-center">
    Sales Records
  </h3>
  {% if sales %}
  <div class="overflow-x-auto shadow rounded-xl max-w-6xl mx-auto">
    <table class="min-w-full bg-white rounded-lg">
      <thead
        class="bg-rose-100 text-rose-800 uppercase text-sm font-semibold select-none"
      >
        <tr>
          <th class="px-6 py-3 text-left">#</th>
          <th class="px-6 py-3 text-left">Product</th>
          <th class="px-6 py-3 text-left">Qty</th>
          <th class="px-6 py-3 text-left">Payment</th>
          <th class="px-6 py-3 text-left">Customer</th>
          <th class="px-6 py-3 text-left">Date</th>
          <th class="px-6 py-3 text-left">Actions</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-200 text-gray-700">
        {% for sale in sales %}
        <tr class="hover:bg-rose-50 transition cursor-default">
          <td class="px-6 py-3 font-medium">{{ loop.index }}</td>
          <td class="px-6 py-3 font-semibold">{{ sale.product }}</td>
          <td class="px-6 py-3">{{ sale.quantity }}</td>
          <td class="px-6 py-3 capitalize text-rose-700 font-semibold">
            {{ sale.payment_method }}
          </td>
          <td class="px-6 py-3 italic text-gray-600">
            {{ sale.customer or '-' }}
          </td>
          <td class="px-6 py-3 text-sm whitespace-nowrap">
            {{ sale.sale_date.strftime('%Y-%m-%d %H:%M') }}
          </td>
          <td class="px-6 py-3 space-x-4">
            <a
              href="{{ url_for('edit_sale', sale_id=sale.id) }}"
              class="text-blue-600 hover:underline font-medium"
              >Edit</a
            >
            <form
              method="POST"
              action="{{ url_for('delete_sale', sale_id=sale.id) }}"
              class="inline"
              onsubmit="return confirm('Are you sure you want to delete this sale?');"
            >
              <button
                type="submit"
                class="text-red-600 hover:underline font-medium bg-transparent border-0 p-0 cursor-pointer"
              >
                Delete
              </button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
  <p class="text-center text-gray-500 italic">No sales records found.</p>
  {% endif %}
</div>
{% endblock %}
